"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var Command,CommandDescription,Project,ProjectDescription,ProjectExample,Result,Prefix,StringConstant,ProjectOptions,ProjectOptionsDescription,HiddenProjectOptions,Interface,PhpLaravelPath,CommandlineHelpTitle,path=require("path"),npm=require("npm"),bash=_interopDefault(require("vamtiger-bash")),vamtigerCopy=require("vamtiger-copy"),copyFile=_interopDefault(require("vamtiger-copy-file")),getFolderContent=_interopDefault(require("vamtiger-get-directory-content")),createFolder=_interopDefault(require("vamtiger-create-directory")),remove=_interopDefault(require("vamtiger-remove"));function ignore(e){return Result.ignored}!function(e){e.help="help",e.project="project"}(Command||(Command={})),function(e){e.help="list commands",e.project="create a new project"}(CommandDescription||(CommandDescription={})),function(e){e.phpLaravel="php-laravel"}(Project||(Project={})),function(e){e.phpLaravel="PHP Laravel"}(ProjectDescription||(ProjectDescription={})),function(e){e.phpLaravel="vamtiger project --type php-laravel php-laravel-project"}(ProjectExample||(ProjectExample={})),function(e){e.createdProject="Created Project",e.ignored="Ignored"}(Result||(Result={})),function(e){e.vamtigerProject="vamtiger-project",e.doubleDash="--"}(Prefix||(Prefix={})),function(e){e.dash="-",e.newline="\n"}(StringConstant||(StringConstant={})),function(e){e.type="type"}(ProjectOptions||(ProjectOptions={})),function(e){e.type="Project type"}(ProjectOptionsDescription||(ProjectOptionsDescription={})),function(e){e.cliInstallOptional="cliInstallOptional"}(HiddenProjectOptions||(HiddenProjectOptions={})),function(e){e.api="API",e.cli="CLI"}(Interface||(Interface={})),function(e){e.testsFeauture="tests/Feature",e.behatYml="behat.yml"}(PhpLaravelPath||(PhpLaravelPath={})),function(e){e.vamtiger="VAMTIGER - Web Development Utility\nhttps://www.npmjs.com/package/vamtiger",e.help="Commands:",e.project="Project Options:",e.projectType="Project Types:"}(CommandlineHelpTitle||(CommandlineHelpTitle={}));const errorMessage={noProjectTypeOptionSpecified:`No --${ProjectOptions.type} option specified (e.g. ${Prefix.vamtigerProject} ${Command.project} --${ProjectOptions.type} ${Project.phpLaravel} projec-name)`,noProjectNameOptionSpecified:`No Project Name specified (e.g. ${Prefix.vamtigerProject} ${Command.project} --${ProjectOptions.type} ${Project.phpLaravel} projec-name)`},projectFolder=path.resolve(__dirname,".."),npmApiInstallOptional={"save-optional":!0,"no-audit":!0,prefix:projectFolder};var bashScript={"npm-install-save-optional.sh":"npm install --save-optional","php-laravel-create-project.sh":"composer create-project laravel/laravel .","php-laravel-install-dependencies.sh":"composer install","php-laravel-install-dev-dependencies.sh":"composer require --dev behat/behat","php-laravel-is-composer-installed.sh":"command -v composer"};function install(e){const{cliInstallOptional:t}=e;return(t?cliInstallOptional:apiInstall)(e)}async function cliInstallOptional(e){const{projects:t}=e,a=t.join(" "),o=`${bashScript["npm-install-save-optional.sh"].trim()} --prefix ${projectFolder} ${a}`;return(await bash(o).catch(e=>e)).toString()}function apiInstall(e){return new Promise((t,a)=>{const{projects:o}=e;npm.load(npmApiInstallOptional,(e,r)=>{e?a(e):npm.commands.install(o,(e,o)=>{e?a(e):t({loadData:r,installData:o})})})})}async function phpLaravel(e){const{project:t,name:a="",destination:o=process.cwd(),cli:r=!1}=e,{path:n}=t&&require(t)||{path:""},i=await getFolderContent(o),p=a&&path.resolve(o,a)||o,c=await bash(bashScript["php-laravel-is-composer-installed.sh"]).then(e=>Boolean(e.toString().trim())),l={source:n,destination:p};i.includes(a)||await createFolder(p),c?await createProjectWithComposer({name:a,source:n,destination:p}):await vamtigerCopy.copy(l)}async function createProjectWithComposer(e){const{source:t,destination:a}=e,o=path.resolve(t,PhpLaravelPath.testsFeauture),r=path.resolve(t,PhpLaravelPath.behatYml),n=path.resolve(a,PhpLaravelPath.behatYml),i=path.resolve(a,PhpLaravelPath.testsFeauture),p={cwd:a},c=await Promise.all([bash(bashScript["php-laravel-create-project.sh"],p).catch(e=>e)]),l=await bash(bashScript["php-laravel-install-dev-dependencies.sh"],p).catch(e=>e),s=await remove({folder:i}).catch(e=>e),m=await vamtigerCopy.copy({source:o,destination:i}).catch(e=>e),h=await copyFile({source:r,destination:n});return{creatProject:c.toString(),installDevDependencies:l.toString(),removeTests:s,copyTests:m,copyBehatYml:h}}const createProject={[Project.phpLaravel]:phpLaravel};async function project(e){const{cliInstallOptional:t=!1,cli:a=!1}=e,o=a&&[CommandlineHelpTitle.vamtiger,"",Result.createdProject].join(StringConstant.newline),r=createProject[e.type]||ignore,n=[Prefix.vamtigerProject,e.type].join(StringConstant.dash),i=r&&{projects:[n],cliInstallOptional:t||a};return i&&await install(i),await r(Object.assign(Object.assign({},e),{project:n})),o&&console.log(o),Result.createdProject}module.exports=project;
//# sourceMappingURL=project.js.map
